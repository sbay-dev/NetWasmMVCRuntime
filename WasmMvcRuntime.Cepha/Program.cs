using System;
using System.Runtime.InteropServices.JavaScript;
using Microsoft.Extensions.DependencyInjection;
using WasmMvcRuntime.Cepha;
using WasmMvcRuntime.Cepha.Kit;

// ???????????????????????????????????????????????????????????????
// ?? Cepha Server � Physarum polycephalum
//    Full ASP.NET Core-compatible WASM server runtime
// ???????????????????????????????????????????????????????????????

CephaInterop.ConsoleLog("[Cepha] initializing Physarum polycephalum server...");

// One-line setup via CephaKit
var services = new ServiceCollection();
services.AddCephaKit();

var serviceProvider = services.BuildServiceProvider();
await serviceProvider.UseCephaKit();

CephaInterop.ConsoleLog("---------------------------------------");
CephaInterop.ConsoleLog("  Cepha is alive - Physarum polycephalum");
CephaInterop.ConsoleLog("  Runtime: WebAssembly (.NET 10)");
CephaInterop.ConsoleLog("  SSE + SignalR + MVC + DB ready");
CephaInterop.ConsoleLog("---------------------------------------");

// ??? Keep the WASM runtime alive ?????????????????????????????
await Task.Delay(Timeout.Infinite);

// ?????????????????????????????????????????????????????????????
// Legacy JSExport for backward compatibility with main.mjs
// ?????????????????????????????????????????????????????????????
public partial class CephaEntry
{
    /// <summary>
    /// Simple greeting export � verifies the WASM module loaded correctly.
    /// </summary>
    [JSExport]
    internal static string Greeting()
    {
        return $"?? Cepha Server v1.0 � Physarum polycephalum | .NET {Environment.Version}";
    }
}

